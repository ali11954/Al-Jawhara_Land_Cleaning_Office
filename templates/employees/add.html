{% extends "base.html" %}

{% block title %}ุฅุถุงูุฉ ููุธู ุฌุฏูุฏ{% endblock %}

{% block header %}ุฅุถุงูุฉ ููุธู ุฌุฏูุฏ{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">
                    <i class="fas fa-user-plus me-2"></i>ุฅุถุงูุฉ ููุธู ุฌุฏูุฏ
                </h6>
            </div>
            <div class="card-body">
                <form method="POST" id="employeeForm" class="needs-validation" novalidate>
                    <!-- ููุท ุญูู ุงููุณูู ุงููุธููู ูู ุงูุจุฏุงูุฉ -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="position" class="form-label">
                                <i class="fas fa-briefcase me-1"></i>ุงููุณูู ุงููุธููู <span class="text-danger">*</span>
                            </label>
                            <select class="form-select" id="position" name="position" required>
                                <option value="">-- ุงุฎุชุฑ ุงููุณูู ุงููุธููู --</option>
                                <option value="supervisor">ูุดุฑู</option>
                                <option value="monitor">ูุฑุงูุจ ูุธุงูุฉ</option>
                                <option value="worker">ุนุงูู ูุธุงูุฉ</option>
                            </select>
                            <div class="invalid-feedback">ูุฑุฌู ุงุฎุชูุงุฑ ุงููุณูู ุงููุธููู</div>
                        </div>
                    </div>

                    <!-- ุฌููุน ุงูุญููู ุงูุฃุฎุฑู - ูุฎููุฉ ูู ุงูุจุฏุงูุฉ -->
                    <div id="allFields" style="display: none;">
                        <!-- ุงูุงุณู ุงููุงูู ูุงููุงุชู -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="full_name" class="form-label">
                                    <i class="fas fa-user me-1"></i>ุงูุงุณู ุงููุงูู <span class="text-danger">*</span>
                                </label>
                                <input type="text" class="form-control" id="full_name" name="full_name" required
                                       placeholder="ุฃุฏุฎู ุงูุงุณู ุงููุงูู">
                                <div class="invalid-feedback">ูุฑุฌู ุฅุฏุฎุงู ุงูุงุณู ุงููุงูู</div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="phone" class="form-label">
                                    <i class="fas fa-phone me-1"></i>ุฑูู ุงููุงุชู
                                </label>
                                <input type="tel" class="form-control" id="phone" name="phone"
                                       placeholder="+967 700 000 000" dir="ltr">
                            </div>
                        </div>

                        <!-- ุงูุดุฑูุฉ -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="company_id" class="form-label">
                                    <i class="fas fa-building me-1"></i>ุงูุดุฑูุฉ <span class="text-danger">*</span>
                                </label>
                                <select class="form-select" id="company_id" name="company_id" required>
                                    <option value="">-- ุงุฎุชุฑ ุงูุดุฑูุฉ --</option>
                                    {% for company in companies %}
                                    <option value="{{ company.id }}">{{ company.name }}</option>
                                    {% endfor %}
                                </select>
                                <div class="invalid-feedback">ูุฑุฌู ุงุฎุชูุงุฑ ุงูุดุฑูุฉ</div>
                            </div>
                        </div>

                        <!-- ุงูุนููุงู -->
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label for="address" class="form-label">
                                    <i class="fas fa-map-marker-alt me-1"></i>ุงูุนููุงู
                                </label>
                                <textarea class="form-control" id="address" name="address" rows="2"
                                          placeholder="ุฃุฏุฎู ุงูุนููุงู ุงููุงูู..."></textarea>
                            </div>
                        </div>

                        <!-- ุงูุฑุงุชุจ ูุชุงุฑูุฎ ุงูุชุนููู ูุงูุญุงูุฉ -->
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="salary" class="form-label">
                                    <i class="fas fa-money-bill me-1"></i>ุงูุฑุงุชุจ (ุฑูุงู ูููู)
                                </label>
                                <input type="number" class="form-control" id="salary" name="salary" step="0.01"
                                       placeholder="ุฃุฏุฎู ุงูุฑุงุชุจ ุงูุดูุฑู" min="0">
                            </div>

                            <div class="col-md-4 mb-3">
                                <label for="hire_date" class="form-label">
                                    <i class="fas fa-calendar-alt me-1"></i>ุชุงุฑูุฎ ุงูุชุนููู <span class="text-danger">*</span>
                                </label>
                                <input type="date" class="form-control" id="hire_date" name="hire_date"
                                       value="{{ today.isoformat() }}" required>
                                <div class="invalid-feedback">ูุฑุฌู ุงุฎุชูุงุฑ ุชุงุฑูุฎ ุงูุชุนููู</div>
                            </div>

                            <div class="col-md-4 mb-3">
                                <label class="form-label d-block">
                                    <i class="fas fa-toggle-on me-1"></i>ุงูุญุงูุฉ
                                </label>
                                <div class="form-check form-switch mt-2">
                                    <input class="form-check-input" type="checkbox" id="is_active" name="is_active" checked>
                                    <label class="form-check-label" for="is_active">ููุธู ูุดุท</label>
                                </div>
                            </div>
                        </div>

                        <!-- ุงููุดุฑู ุงููุจุงุดุฑ - ูุธูุฑ ูููุฑุงูุจูู ูุงูุนูุงู ููุท -->
                        <div class="row" id="supervisorRow" style="display: none;">
                            <div class="col-md-6 mb-3">
                                <label for="supervisor_id" class="form-label">
                                    <i class="fas fa-user-tie me-1"></i>ุงููุดุฑู ุงููุจุงุดุฑ
                                </label>
                                <select class="form-select" id="supervisor_id" name="supervisor_id">
                                    <option value="">-- ุจุฏูู ูุดุฑู ูุจุงุดุฑ --</option>
                                    {% for supervisor in supervisors %}
                                    <option value="{{ supervisor.id }}">{{ supervisor.full_name }}</option>
                                    {% endfor %}
                                </select>
                                <div class="form-text">ุงุฎุชุฑ ุงููุดุฑู ุงููุณุคูู ุนู ูุฐุง ุงูููุธู</div>
                            </div>
                        </div>

                        <!-- ุญููู ุงููุณุชุฎุฏู - ุชุธูุฑ ูููุดุฑููู ููุท -->
                        <div id="userFields" style="display: none;">
                            <hr class="my-4">
                            <div class="alert alert-primary mb-3">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>ูุนูููุงุช ุชุณุฌูู ุงูุฏุฎูู:</strong> ุณูุชู ุฅูุดุงุก ุญุณุงุจ ูููุดุฑู
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="username" class="form-label">
                                        <i class="fas fa-user-circle me-1"></i>ุงุณู ุงููุณุชุฎุฏู <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="username" name="username"
                                               placeholder="ุฃุฏุฎู ุงุณู ุงููุณุชุฎุฏู" autocomplete="off">
                                        <button class="btn btn-outline-secondary" type="button" id="checkUsernameBtn">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                    <div class="invalid-feedback username-feedback"></div>
                                    <div class="form-text">3 ุฃุญุฑู ุนูู ุงูุฃูู</div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label for="password" class="form-label">
                                        <i class="fas fa-key me-1"></i>ูููุฉ ุงููุฑูุฑ <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="password" class="form-control" id="password" name="password"
                                               placeholder="ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ" autocomplete="off">
                                        <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <div class="form-text">6 ุฃุญุฑู ุนูู ุงูุฃูู</div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="confirm_password" class="form-label">
                                        <i class="fas fa-check-circle me-1"></i>ุชุฃููุฏ ูููุฉ ุงููุฑูุฑ <span class="text-danger">*</span>
                                    </label>
                                    <input type="password" class="form-control" id="confirm_password" name="confirm_password"
                                           placeholder="ุฃุนุฏ ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ" autocomplete="off">
                                    <div class="invalid-feedback" id="passwordMatchFeedback"></div>
                                </div>

                                <div class="col-md-6 mb-3 d-flex align-items-end">
                                    <button class="btn btn-sm btn-info" type="button" id="generatePasswordBtn">
                                        <i class="fas fa-random me-1"></i>ุชูููุฏ ูููุฉ ูุฑูุฑ ุนุดูุงุฆูุฉ
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- ุงูููุงุญุธุงุช ูุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช -->
                        <div class="alert alert-info mt-4">
                            <h6 class="alert-heading">
                                <i class="fas fa-info-circle me-2"></i>ูุนูููุงุช ูููุฉ
                            </h6>
                            <ul class="mb-0 small">
                                <li>ุฌููุน ุงูุญููู ุงูุชู ุชุญูู ุนูุงูุฉ <span class="text-danger">*</span> ุฅูุฒุงููุฉ</li>
                                <li>ูุชู ุชุญุฏูุฏ ุตูุงุญูุงุช ุงูููุธู ุจูุงุกู ุนูู ุงููุณูู ุงููุธููู</li>
                                <li class="text-primary">ุญุณุงุจ ุงููุณุชุฎุฏู ูููุดุฃ ููุท ูููุดุฑููู</li>
                            </ul>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                            <a href="{{ url_for('employees_list') }}" class="btn btn-secondary me-md-2">
                                <i class="fas fa-times me-1"></i>ุฅูุบุงุก ูุงูุนูุฏุฉ
                            </a>
                            <button type="submit" class="btn btn-primary" id="submitBtn">
                                <i class="fas fa-save me-1"></i>ุญูุธ ุงูููุธู
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const positionSelect = document.getElementById('position');
    const allFields = document.getElementById('allFields');
    const supervisorRow = document.getElementById('supervisorRow');
    const userFields = document.getElementById('userFields');

    console.log('โ ุชู ุชุญููู ุงูุตูุญุฉ - ูู ุงูุชุธุงุฑ ุงุฎุชูุงุฑ ุงููุณูู ุงููุธููู');

    positionSelect.addEventListener('change', function() {
        const position = this.value;
        console.log('๐ ุชู ุงุฎุชูุงุฑ:', position);

        if (position) {
            // ุฅุธูุงุฑ ุฌููุน ุงูุญููู ุงูุฃุณุงุณูุฉ
            allFields.style.display = 'block';

            // ุฅุฎูุงุก ุงูุญููู ุงูุฎุงุตุฉ ุฃููุงู
            supervisorRow.style.display = 'none';
            userFields.style.display = 'none';

            // ุฅุนุงุฏุฉ ุชุนููู ุงูุญููู
            if (document.getElementById('username')) {
                document.getElementById('username').required = false;
                document.getElementById('password').required = false;
                document.getElementById('confirm_password').required = false;
            }

            // ุฅุธูุงุฑ ุงูุญููู ุงูููุงุณุจุฉ ุญุณุจ ุงููุณูู
            if (position === 'supervisor') {
                userFields.style.display = 'block';
                document.getElementById('username').required = true;
                document.getElementById('password').required = true;
                document.getElementById('confirm_password').required = true;
                console.log('โ ุชู ุฅุธูุงุฑ ุญููู ุงููุณุชุฎุฏู ูููุดุฑู');
            }
            else if (position === 'monitor' || position === 'worker') {
                supervisorRow.style.display = 'block';
                console.log('โ ุชู ุฅุธูุงุฑ ุงููุดุฑู ุงููุจุงุดุฑ ูููุฑุงูุจ/ุงูุนุงูู');
            }
        } else {
            // ุฅุฎูุงุก ุฌููุน ุงูุญููู ุงูุฃุฎุฑู
            allFields.style.display = 'none';
            console.log('๐ป ุชู ุฅุฎูุงุก ุฌููุน ุงูุญููู');
        }
    });
});
</script>

<style>
    .card {
        border: none;
        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
    }
    .card-header {
        background-color: #f8f9fc;
        border-bottom: 1px solid #e3e6f0;
    }
    .form-label {
        font-weight: 500;
        color: #2c3e50;
        margin-bottom: 0.3rem;
    }
    .form-control:focus, .form-select:focus {
        border-color: #4e73df;
        box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
    }
    .alert-primary {
        background-color: #cce5ff;
        border-color: #b8daff;
        color: #004085;
    }
    .alert-info {
        background-color: #e1f5fe;
        border-color: #b3e5fc;
        color: #01579b;
    }
    #allFields {
        transition: all 0.3s ease;
    }
</style>
{% endblock %}
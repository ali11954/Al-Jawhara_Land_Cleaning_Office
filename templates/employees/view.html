{% extends "base.html" %}

{% block title %}تفاصيل الموظف - {{ employee.full_name }}{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <!-- رأس الصفحة -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{{ url_for('employees_list') }}">الموظفين</a></li>
                            <li class="breadcrumb-item active">تفاصيل الموظف</li>
                        </ol>
                    </nav>
                    <h2 class="text-primary mb-1">
                        <i class="fas fa-user-circle me-2"></i>{{ employee.full_name }}
                    </h2>
                    <p class="text-muted mb-0">تفاصيل الموظف وسجلات الحضور</p>
                </div>
                <div class="d-flex gap-2">
                    <a href="{{ url_for('employees_list') }}" class="btn btn-secondary">
                        <i class="fas fa-arrow-right me-2"></i>العودة
                    </a>
                    {% if current_user.role in ['owner', 'supervisor'] %}
                    <a href="{{ url_for('edit_employee', id=employee.id) }}" class="btn btn-warning">
                        <i class="fas fa-edit me-2"></i>تعديل
                    </a>
                    {% endif %}
                </div>
            </div>

            <div class="row">
                <!-- معلومات الموظف -->
                <div class="col-lg-4 mb-4">
                    <div class="card shadow-sm h-100">
                        <div class="card-header bg-primary text-white">
                            <h6 class="mb-0">
                                <i class="fas fa-info-circle me-2"></i>معلومات الموظف
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="text-center mb-4">
                                <div class="avatar-circle-lg mx-auto mb-3">
                                    <span class="initials-lg">{{ employee.full_name[0] if employee.full_name else '?' }}</span>
                                </div>
                                <h4 class="text-dark">{{ employee.full_name }}</h4>
                                <span class="badge
                                    {% if employee.position == 'owner' %}bg-danger
                                    {% elif employee.position == 'supervisor' %}bg-warning
                                    {% elif employee.position == 'monitor' %}bg-info
                                    {% else %}bg-secondary{% endif %} p-2">
                                    {{ employee.position }}
                                </span>
                            </div>

                            <div class="list-group list-group-flush">
                                <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                                    <span class="fw-bold">الحالة:</span>
                                    {% if employee.is_active %}
                                    <span class="badge bg-success">نشط</span>
                                    {% else %}
                                    <span class="badge bg-danger">غير نشط</span>
                                    {% endif %}
                                </div>

                                {% if employee.phone %}
                                <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                                    <span class="fw-bold">الهاتف:</span>
                                    <a href="tel:{{ employee.phone }}" class="text-decoration-none">
                                        {{ employee.phone }}
                                    </a>
                                </div>
                                {% endif %}

                                {% if employee.user_account %}
                                <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                                    <span class="fw-bold">اسم المستخدم:</span>
                                    <span>{{ employee.user_account.username }}</span>
                                </div>
                                {% endif %}

                                <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                                    <span class="fw-bold">تاريخ التعيين:</span>
                                    <span>{{ employee.hire_date.strftime('%Y-%m-%d') if employee.hire_date else 'غير محدد' }}</span>
                                </div>

                                {% if employee.salary %}
                                <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                                    <span class="fw-bold">الراتب:</span>
                                    <span class="text-success">{{ "{:,.0f}".format(employee.salary) }} ر.س</span>
                                </div>
                                {% endif %}

                                {% if employee.company %}
                                <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                                    <span class="fw-bold">الشركة:</span>
                                    <span>{{ employee.company.name }}</span>
                                </div>
                                {% endif %}
                            </div>

                            {% if employee.address %}
                            <div class="mt-3">
                                <h6 class="fw-bold">العنوان:</h6>
                                <p class="text-muted">{{ employee.address }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- إحصائيات الحضور -->
                <div class="col-lg-8">
                    <div class="row mb-4">
                        <div class="col-md-3 mb-3">
                            <div class="card border-left-primary shadow h-100">
                                <div class="card-body">
                                    <div class="text-center">
                                        <div class="h3 text-primary mb-1">{{ total_records }}</div>
                                        <div class="text-xs font-weight-bold text-primary text-uppercase">
                                            إجمالي السجلات
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3 mb-3">
                            <div class="card border-left-success shadow h-100">
                                <div class="card-body">
                                    <div class="text-center">
                                        <div class="h3 text-success mb-1">{{ present_count }}</div>
                                        <div class="text-xs font-weight-bold text-success text-uppercase">
                                            أيام حضور
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3 mb-3">
                            <div class="card border-left-danger shadow h-100">
                                <div class="card-body">
                                    <div class="text-center">
                                        <div class="h3 text-danger mb-1">{{ absent_count }}</div>
                                        <div class="text-xs font-weight-bold text-danger text-uppercase">
                                            أيام غياب
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3 mb-3">
                            <div class="card border-left-warning shadow h-100">
                                <div class="card-body">
                                    <div class="text-center">
                                        <div class="h3 text-warning mb-1">{{ late_count }}</div>
                                        <div class="text-xs font-weight-bold text-warning text-uppercase">
                                            تأخير
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- سجلات الحضور الحديثة -->
                    <div class="card shadow-sm">
                        <div class="card-header bg-white d-flex justify-content-between align-items-center">
                            <h6 class="mb-0 text-primary">
                                <i class="fas fa-history me-2"></i>آخر سجلات الحضور
                            </h6>
                            <a href="{{ url_for('attendance_index') }}?employee={{ employee.id }}" class="btn btn-sm btn-outline-primary">
                                عرض الكل
                            </a>
                        </div>
                        <div class="card-body">
                            {% if recent_attendance %}
                            <div class="table-responsive">
                                <table class="table table-sm table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>التاريخ</th>
                                            <th>الوردية</th>
                                            <th>الحالة</th>
                                            <th>وقت الحضور</th>
                                            <th>وقت الانصراف</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for record in recent_attendance %}
                                        <tr>
                                            <td>{{ record.date.strftime('%Y-%m-%d') }}</td>
                                            <td>
                                                {% if record.shift_type == 'morning' %}
                                                <span class="badge bg-info">صباحية</span>
                                                {% else %}
                                                <span class="badge bg-warning">مسائية</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if record.status == 'present' %}
                                                <span class="badge bg-success">حاضر</span>
                                                {% elif record.status == 'absent' %}
                                                <span class="badge bg-danger">غائب</span>
                                                {% elif record.status == 'late' %}
                                                <span class="badge bg-warning">متأخر</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if record.check_in %}
                                                {{ record.check_in.strftime('%H:%M') }}
                                                {% else %}
                                                <span class="text-muted">-</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if record.check_out %}
                                                {{ record.check_out.strftime('%H:%M') }}
                                                {% else %}
                                                <span class="text-muted">-</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <div class="text-center py-4">
                                <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                                <h5 class="text-muted">لا توجد سجلات حضور</h5>
                                <p class="text-muted">لم يتم تسجيل أي حضور لهذا الموظف بعد</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
.avatar-circle-lg {
    width: 100px;
    height: 100px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 2rem;
}

.breadcrumb {
    background: none;
    padding: 0;
    margin-bottom: 1rem;
}

.breadcrumb-item + .breadcrumb-item::before {
    content: "›";
    color: #6c757d;
}
</style>
{% endblock %}